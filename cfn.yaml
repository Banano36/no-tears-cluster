Mappings:
  RegionMap:
    us-west-2:
      RegionBucket: ebbollig-notearshpc-120988395753-us-west-2
    us-west-1:
      RegionBucket: ebbollig-notearshpc-120988395753-us-west-1
    us-east-2:
      RegionBucket: ebbollig-notearshpc-120988395753-us-east-2
    us-east-1:
      RegionBucket: ebbollig-notearshpc-120988395753-us-east-1
    eu-central-1:
      RegionBucket: ebbollig-notearshpc-120988395753-eu-central-1
    ap-southeast-2:
      RegionBucket: ebbollig-notearshpc-120988395753-ap-southeast-2
    ap-southeast-1:
      RegionBucket: ebbollig-notearshpc-120988395753-ap-southeast-1
    ca-central-1:
      RegionBucket: ebbollig-notearshpc-120988395753-ca-central-1
    sa-east-1:
      RegionBucket: ebbollig-notearshpc-120988395753-sa-east-1
    ap-northeast-1:
      RegionBucket: ebbollig-notearshpc-120988395753-ap-northeast-1
    ap-northeast-2:
      RegionBucket: ebbollig-notearshpc-120988395753-ap-northeast-2
    ap-northeast-3:
      RegionBucket: ebbollig-notearshpc-120988395753-ap-northeast-3
    eu-west-1:
      RegionBucket: ebbollig-notearshpc-120988395753-eu-west-1
    eu-west-2:
      RegionBucket: ebbollig-notearshpc-120988395753-eu-west-2
    eu-west-3:
      RegionBucket: ebbollig-notearshpc-120988395753-eu-west-3
    ap-south-1:
      RegionBucket: ebbollig-notearshpc-120988395753-ap-south-1
    eu-north-1:
      RegionBucket: ebbollig-notearshpc-120988395753-eu-north-1


Parameters:
  ConfigS3URI:
    Type: String
    Default: https://notearshpc-quickstart.s3.amazonaws.com/0.1.0/config.ini
    Description: Set a custom parallelcluster config file.
  UserPasswordParameter:
    Type: String
    Description: Set a password for the hpc-quickstart user
    NoEcho: true
  AssetParameters9c761b804ba7cab28d2fd36fee5aa148843ae638efacbfe6873873076ddc24cfS3Bucket59123DCB:
    Type: String
    Description: S3 bucket for asset "9c761b804ba7cab28d2fd36fee5aa148843ae638efacbfe6873873076ddc24cf"
    Default: "ebbollig-notearshpc-120988395753"
  AssetParameters9c761b804ba7cab28d2fd36fee5aa148843ae638efacbfe6873873076ddc24cfS3VersionKeyFDCEC68A:
    Type: String
    Description: S3 key for asset version "9c761b804ba7cab28d2fd36fee5aa148843ae638efacbfe6873873076ddc24cf"
    Default: "0.1.0/asset/9c761b804ba7cab28d2fd36fee5aa148843ae638efacbfe6873873076ddc24cf.sh||"
  AssetParameters9c761b804ba7cab28d2fd36fee5aa148843ae638efacbfe6873873076ddc24cfArtifactHash7CB53B19:
    Type: String
    Description: Artifact hash for asset "9c761b804ba7cab28d2fd36fee5aa148843ae638efacbfe6873873076ddc24cf"
  AssetParameters1f8b4760af092cc9f4253348dd8d0713337cb9dc8163e76a45d3815dffd38187S3Bucket1CCD4369:
    Type: String
    Description: S3 bucket for asset "1f8b4760af092cc9f4253348dd8d0713337cb9dc8163e76a45d3815dffd38187"
    Default: "ebbollig-notearshpc-120988395753"
  AssetParameters1f8b4760af092cc9f4253348dd8d0713337cb9dc8163e76a45d3815dffd38187S3VersionKey3E1A0BD1:
    Type: String
    Description: S3 key for asset version "1f8b4760af092cc9f4253348dd8d0713337cb9dc8163e76a45d3815dffd38187"
    Default: "0.1.0/asset/1f8b4760af092cc9f4253348dd8d0713337cb9dc8163e76a45d3815dffd38187.sh||"
  AssetParameters1f8b4760af092cc9f4253348dd8d0713337cb9dc8163e76a45d3815dffd38187ArtifactHashE8EAE5BE:
    Type: String
    Description: Artifact hash for asset "1f8b4760af092cc9f4253348dd8d0713337cb9dc8163e76a45d3815dffd38187"
  AssetParametersdb9afb32f11d5a6d27d926a7a69534f2f60c256e04782b6d75c5177cf6c51cf6S3BucketAC523105:
    Type: String
    Description: S3 bucket for asset "db9afb32f11d5a6d27d926a7a69534f2f60c256e04782b6d75c5177cf6c51cf6"
    Default: "ebbollig-notearshpc-120988395753"
  AssetParametersdb9afb32f11d5a6d27d926a7a69534f2f60c256e04782b6d75c5177cf6c51cf6S3VersionKeyD868A528:
    Type: String
    Description: S3 key for asset version "db9afb32f11d5a6d27d926a7a69534f2f60c256e04782b6d75c5177cf6c51cf6"
    Default: "0.1.0/asset/db9afb32f11d5a6d27d926a7a69534f2f60c256e04782b6d75c5177cf6c51cf6.ini||"
  AssetParametersdb9afb32f11d5a6d27d926a7a69534f2f60c256e04782b6d75c5177cf6c51cf6ArtifactHashAA4A2499:
    Type: String
    Description: Artifact hash for asset "db9afb32f11d5a6d27d926a7a69534f2f60c256e04782b6d75c5177cf6c51cf6"
  AssetParametersd23171738749dcc1786a0493c9e9bc342bd568ae09df62c22c5bfe899d9d330bS3Bucket43945E45:
    Type: String
    Description: S3 bucket for asset "d23171738749dcc1786a0493c9e9bc342bd568ae09df62c22c5bfe899d9d330b"
    Default: "ebbollig-notearshpc-120988395753"
  AssetParametersd23171738749dcc1786a0493c9e9bc342bd568ae09df62c22c5bfe899d9d330bS3VersionKeyD437664E:
    Type: String
    Description: S3 key for asset version "d23171738749dcc1786a0493c9e9bc342bd568ae09df62c22c5bfe899d9d330b"
    Default: "0.1.0/asset/d23171738749dcc1786a0493c9e9bc342bd568ae09df62c22c5bfe899d9d330b.zip||"
  AssetParametersd23171738749dcc1786a0493c9e9bc342bd568ae09df62c22c5bfe899d9d330bArtifactHash5F6D0215:
    Type: String
    Description: Artifact hash for asset "d23171738749dcc1786a0493c9e9bc342bd568ae09df62c22c5bfe899d9d330b"
  AssetParameters812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14S3BucketE74F71F4:
    Type: String
    Description: S3 bucket for asset "812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14"
    Default: "ebbollig-notearshpc-120988395753"
  AssetParameters812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14S3VersionKeyCDA54A41:
    Type: String
    Description: S3 key for asset version "812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14"
    Default: "0.1.0/asset/812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14.zip||"
  AssetParameters812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14ArtifactHash47216AA1:
    Type: String
    Description: Artifact hash for asset "812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14"
  AssetParametersc48822457e8605e268f475d3928a59915c8bb7e090f602882e65a2dcb6f26c8fS3Bucket85295B09:
    Type: String
    Description: S3 bucket for asset "c48822457e8605e268f475d3928a59915c8bb7e090f602882e65a2dcb6f26c8f"
    Default: "ebbollig-notearshpc-120988395753"
  AssetParametersc48822457e8605e268f475d3928a59915c8bb7e090f602882e65a2dcb6f26c8fS3VersionKey4A4E4131:
    Type: String
    Description: S3 key for asset version "c48822457e8605e268f475d3928a59915c8bb7e090f602882e65a2dcb6f26c8f"
    Default: "0.1.0/asset/c48822457e8605e268f475d3928a59915c8bb7e090f602882e65a2dcb6f26c8f.zip||"
  AssetParametersc48822457e8605e268f475d3928a59915c8bb7e090f602882e65a2dcb6f26c8fArtifactHashC4A6F08C:
    Type: String
    Description: Artifact hash for asset "c48822457e8605e268f475d3928a59915c8bb7e090f602882e65a2dcb6f26c8f"
  AssetParameters68144a2b2756f242701a24eb133be85c64921da0317f4d548d4ae8c39a2c30bfS3Bucket71C6F187:
    Type: String
    Description: S3 bucket for asset "68144a2b2756f242701a24eb133be85c64921da0317f4d548d4ae8c39a2c30bf"
    Default: "ebbollig-notearshpc-120988395753"
  AssetParameters68144a2b2756f242701a24eb133be85c64921da0317f4d548d4ae8c39a2c30bfS3VersionKey28D10DE9:
    Type: String
    Description: S3 key for asset version "68144a2b2756f242701a24eb133be85c64921da0317f4d548d4ae8c39a2c30bf"
    Default: "0.1.0/asset/68144a2b2756f242701a24eb133be85c64921da0317f4d548d4ae8c39a2c30bf.zip||"
  AssetParameters68144a2b2756f242701a24eb133be85c64921da0317f4d548d4ae8c39a2c30bfArtifactHashFE9FEA44:
    Type: String
    Description: Artifact hash for asset "68144a2b2756f242701a24eb133be85c64921da0317f4d548d4ae8c39a2c30bf"
  BudgetLimit:
    Type: Number
    Default: 2000
    Description: The initial budget for this project in USD ($).
  NotificationEmail:
    Type: String
    Default: email@amazon.com
    Description: This email address will receive billing alarm notifications when 80% of the budget limit is reached.
Resources:
  VPCB9E5F0B4:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/20
      EnableDnsHostnames: true
      EnableDnsSupport: true
      InstanceTenancy: default
      Tags:
        - Key: Name
          Value: pcluster/VPC
    Metadata:
      aws:cdk:path: pcluster/VPC/Resource
  VPCPublicSubnet1SubnetB4246D30:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.0.0/22
      VpcId:
        Ref: VPCB9E5F0B4
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: aws-cdk:subnet-name
          Value: Public
        - Key: aws-cdk:subnet-type
          Value: Public
        - Key: Name
          Value: pcluster/VPC/PublicSubnet1
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/Subnet
  VPCPublicSubnet1RouteTableFEE4B781:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: VPCB9E5F0B4
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet1
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/RouteTable
  VPCPublicSubnet1RouteTableAssociation0B0896DC:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: VPCPublicSubnet1RouteTableFEE4B781
      SubnetId:
        Ref: VPCPublicSubnet1SubnetB4246D30
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/RouteTableAssociation
  VPCPublicSubnet1DefaultRoute91CEF279:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: VPCPublicSubnet1RouteTableFEE4B781
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId:
        Ref: VPCIGWB7E252D3
    DependsOn:
      - VPCVPCGW99B986DC
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/DefaultRoute
  VPCPublicSubnet1EIP6AD938E8:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet1
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/EIP
  VPCPublicSubnet1NATGatewayE0556630:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId:
        Fn::GetAtt:
          - VPCPublicSubnet1EIP6AD938E8
          - AllocationId
      SubnetId:
        Ref: VPCPublicSubnet1SubnetB4246D30
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet1
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/NATGateway
  VPCPublicSubnet2Subnet74179F39:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.4.0/22
      VpcId:
        Ref: VPCB9E5F0B4
      AvailabilityZone:
        Fn::Select:
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: aws-cdk:subnet-name
          Value: Public
        - Key: aws-cdk:subnet-type
          Value: Public
        - Key: Name
          Value: pcluster/VPC/PublicSubnet2
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/Subnet
  VPCPublicSubnet2RouteTable6F1A15F1:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: VPCB9E5F0B4
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet2
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/RouteTable
  VPCPublicSubnet2RouteTableAssociation5A808732:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: VPCPublicSubnet2RouteTable6F1A15F1
      SubnetId:
        Ref: VPCPublicSubnet2Subnet74179F39
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/RouteTableAssociation
  VPCPublicSubnet2DefaultRouteB7481BBA:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: VPCPublicSubnet2RouteTable6F1A15F1
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId:
        Ref: VPCIGWB7E252D3
    DependsOn:
      - VPCVPCGW99B986DC
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/DefaultRoute
  VPCPublicSubnet2EIP4947BC00:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet2
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/EIP
  VPCPublicSubnet2NATGateway3C070193:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId:
        Fn::GetAtt:
          - VPCPublicSubnet2EIP4947BC00
          - AllocationId
      SubnetId:
        Ref: VPCPublicSubnet2Subnet74179F39
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet2
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/NATGateway
  VPCPrivateSubnet1Subnet8BCA10E0:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.8.0/22
      VpcId:
        Ref: VPCB9E5F0B4
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: aws-cdk:subnet-name
          Value: Private
        - Key: aws-cdk:subnet-type
          Value: Private
        - Key: Name
          Value: pcluster/VPC/PrivateSubnet1
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet1/Subnet
  VPCPrivateSubnet1RouteTableBE8A6027:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: VPCB9E5F0B4
      Tags:
        - Key: Name
          Value: pcluster/VPC/PrivateSubnet1
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet1/RouteTable
  VPCPrivateSubnet1RouteTableAssociation347902D1:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: VPCPrivateSubnet1RouteTableBE8A6027
      SubnetId:
        Ref: VPCPrivateSubnet1Subnet8BCA10E0
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet1/RouteTableAssociation
  VPCPrivateSubnet1DefaultRouteAE1D6490:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: VPCPrivateSubnet1RouteTableBE8A6027
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId:
        Ref: VPCPublicSubnet1NATGatewayE0556630
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet1/DefaultRoute
  VPCPrivateSubnet2SubnetCFCDAA7A:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.12.0/22
      VpcId:
        Ref: VPCB9E5F0B4
      AvailabilityZone:
        Fn::Select:
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: aws-cdk:subnet-name
          Value: Private
        - Key: aws-cdk:subnet-type
          Value: Private
        - Key: Name
          Value: pcluster/VPC/PrivateSubnet2
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet2/Subnet
  VPCPrivateSubnet2RouteTable0A19E10E:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: VPCB9E5F0B4
      Tags:
        - Key: Name
          Value: pcluster/VPC/PrivateSubnet2
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet2/RouteTable
  VPCPrivateSubnet2RouteTableAssociation0C73D413:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: VPCPrivateSubnet2RouteTable0A19E10E
      SubnetId:
        Ref: VPCPrivateSubnet2SubnetCFCDAA7A
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet2/RouteTableAssociation
  VPCPrivateSubnet2DefaultRouteF4F5CFD2:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: VPCPrivateSubnet2RouteTable0A19E10E
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId:
        Ref: VPCPublicSubnet2NATGateway3C070193
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet2/DefaultRoute
  VPCIGWB7E252D3:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: pcluster/VPC
    Metadata:
      aws:cdk:path: pcluster/VPC/IGW
  VPCVPCGW99B986DC:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId:
        Ref: VPCB9E5F0B4
      InternetGatewayId:
        Ref: VPCIGWB7E252D3
    Metadata:
      aws:cdk:path: pcluster/VPC/VPCGW
  VPCS3CC6C5EE4:
    Type: AWS::EC2::VPCEndpoint
    Properties:
      ServiceName:
        Fn::Join:
          - ""
          - - com.amazonaws.
            - Ref: AWS::Region
            - .s3
      VpcId:
        Ref: VPCB9E5F0B4
      RouteTableIds:
        - Ref: VPCPrivateSubnet1RouteTableBE8A6027
        - Ref: VPCPrivateSubnet2RouteTable0A19E10E
        - Ref: VPCPublicSubnet1RouteTableFEE4B781
        - Ref: VPCPublicSubnet2RouteTable6F1A15F1
      VpcEndpointType: Gateway
    Metadata:
      aws:cdk:path: pcluster/VPC/S3/Resource
  VPCDynamoDB137E34D7:
    Type: AWS::EC2::VPCEndpoint
    Properties:
      ServiceName:
        Fn::Join:
          - ""
          - - com.amazonaws.
            - Ref: AWS::Region
            - .dynamodb
      VpcId:
        Ref: VPCB9E5F0B4
      RouteTableIds:
        - Ref: VPCPrivateSubnet1RouteTableBE8A6027
        - Ref: VPCPrivateSubnet2RouteTable0A19E10E
        - Ref: VPCPublicSubnet1RouteTableFEE4B781
        - Ref: VPCPublicSubnet2RouteTable6F1A15F1
      VpcEndpointType: Gateway
    Metadata:
      aws:cdk:path: pcluster/VPC/DynamoDB/Resource
  DataRepositoryB58C03BE:
    Type: AWS::S3::Bucket
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: pcluster/DataRepository/Resource
  CloudTrailLogsBBCFF69F:
    Type: AWS::S3::Bucket
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: pcluster/CloudTrailLogs/Resource
  CloudTrailLogsPolicy2265F07C:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket:
        Ref: CloudTrailLogsBBCFF69F
      PolicyDocument:
        Statement:
          - Action: s3:GetBucketAcl
            Effect: Allow
            Principal:
              Service: cloudtrail.amazonaws.com
            Resource:
              Fn::GetAtt:
                - CloudTrailLogsBBCFF69F
                - Arn
          - Action: s3:PutObject
            Condition:
              StringEquals:
                s3:x-amz-acl: bucket-owner-full-control
            Effect: Allow
            Principal:
              Service: cloudtrail.amazonaws.com
            Resource:
              Fn::Join:
                - ""
                - - Fn::GetAtt:
                      - CloudTrailLogsBBCFF69F
                      - Arn
                  - /AWSLogs/
                  - Ref: AWS::AccountId
                  - /*
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: pcluster/CloudTrailLogs/Policy/Resource
  CloudTrailA62D711D:
    Type: AWS::CloudTrail::Trail
    Properties:
      IsLogging: true
      S3BucketName:
        Ref: CloudTrailLogsBBCFF69F
      EnableLogFileValidation: true
      EventSelectors: []
      IncludeGlobalServiceEvents: true
      IsMultiRegionTrail: true
    DependsOn:
      - CloudTrailLogsPolicy2265F07C
    Metadata:
      aws:cdk:path: pcluster/CloudTrail/Resource
  ResearchWorkspace61444B30:
    Type: AWS::Cloud9::EnvironmentEC2
    Properties:
      InstanceType: c5.large
      SubnetId:
        Ref: VPCPublicSubnet1SubnetB4246D30
    Metadata:
      aws:cdk:path: pcluster/ResearchWorkspace/Resource
  Cloud9CreateKeypairRole4A1B132A:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: pcluster/Cloud9CreateKeypairRole/Resource
  Cloud9CreateKeypairRoleDefaultPolicyE908AE36:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - ec2:CreateKeyPair
              - ec2:DeleteKeyPair
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: Cloud9CreateKeypairRoleDefaultPolicyE908AE36
      Roles:
        - Ref: Cloud9CreateKeypairRole4A1B132A
    Metadata:
      aws:cdk:path: pcluster/Cloud9CreateKeypairRole/DefaultPolicy/Resource
  C9CreateKeyPairLambda8FC204C3:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersd23171738749dcc1786a0493c9e9bc342bd568ae09df62c22c5bfe899d9d330bS3VersionKeyD437664E
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersd23171738749dcc1786a0493c9e9bc342bd568ae09df62c22c5bfe899d9d330bS3VersionKeyD437664E
      Handler: lambda_function.handler
      Role:
        Fn::GetAtt:
          - Cloud9CreateKeypairRole4A1B132A
          - Arn
      Runtime: python3.6
      Timeout: 300
    DependsOn:
      - Cloud9CreateKeypairRoleDefaultPolicyE908AE36
      - Cloud9CreateKeypairRole4A1B132A
    Metadata:
      aws:cdk:path: pcluster/C9CreateKeyPairLambda/Resource
      aws:asset:path: asset.d23171738749dcc1786a0493c9e9bc342bd568ae09df62c22c5bfe899d9d330b
      aws:asset:property: Code
  C9CreateKeyPairProviderframeworkonEventServiceRoleE6670C17:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: pcluster/C9CreateKeyPairProvider/framework-onEvent/ServiceRole/Resource
  C9CreateKeyPairProviderframeworkonEventServiceRoleDefaultPolicy904E9C0C:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - C9CreateKeyPairLambda8FC204C3
                - Arn
        Version: "2012-10-17"
      PolicyName: C9CreateKeyPairProviderframeworkonEventServiceRoleDefaultPolicy904E9C0C
      Roles:
        - Ref: C9CreateKeyPairProviderframeworkonEventServiceRoleE6670C17
    Metadata:
      aws:cdk:path: pcluster/C9CreateKeyPairProvider/framework-onEvent/ServiceRole/DefaultPolicy/Resource
  C9CreateKeyPairProviderframeworkonEvent9134FC48:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14S3VersionKeyCDA54A41
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14S3VersionKeyCDA54A41
      Handler: framework.onEvent
      Role:
        Fn::GetAtt:
          - C9CreateKeyPairProviderframeworkonEventServiceRoleE6670C17
          - Arn
      Runtime: nodejs10.x
      Description: AWS CDK resource provider framework - onEvent (pcluster/C9CreateKeyPairProvider)
      Environment:
        Variables:
          USER_ON_EVENT_FUNCTION_ARN:
            Fn::GetAtt:
              - C9CreateKeyPairLambda8FC204C3
              - Arn
      Timeout: 900
    DependsOn:
      - C9CreateKeyPairProviderframeworkonEventServiceRoleDefaultPolicy904E9C0C
      - C9CreateKeyPairProviderframeworkonEventServiceRoleE6670C17
    Metadata:
      aws:cdk:path: pcluster/C9CreateKeyPairProvider/framework-onEvent/Resource
      aws:asset:path: asset.812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14
      aws:asset:property: Code
  C9CreateKeyPair:
    Type: AWS::CloudFormation::CustomResource
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - C9CreateKeyPairLambda8FC204C3
          - Arn
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: pcluster/C9CreateKeyPair/Default
  SshPrivateKeySecret:
    Type: AWS::SecretsManager::Secret
    Properties:
      SecretString:
        Fn::GetAtt:
          - C9CreateKeyPair
          - PrivateKey
    Metadata:
      aws:cdk:path: pcluster/SshPrivateKeySecret
  ParallelClusterUserPolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - ec2:DescribeKeyPairs
              - ec2:DescribeRegions
              - ec2:DescribeVpcs
              - ec2:DescribeSubnets
              - ec2:DescribeSecurityGroups
              - ec2:DescribePlacementGroups
              - ec2:DescribeImages
              - ec2:DescribeInstances
              - ec2:DescribeInstanceStatus
              - ec2:DescribeSnapshots
              - ec2:DescribeVolumes
              - ec2:DescribeVpcAttribute
              - ec2:DescribeAddresses
              - ec2:CreateTags
              - ec2:DescribeNetworkInterfaces
              - ec2:DescribeAvailabilityZones
            Effect: Allow
            Resource: "*"
            Sid: EC2Describe
          - Action:
              - ec2:CreateVpc
              - ec2:ModifyVpcAttribute
              - ec2:DescribeNatGateways
              - ec2:CreateNatGateway
              - ec2:DescribeInternetGateways
              - ec2:CreateInternetGateway
              - ec2:AttachInternetGateway
              - ec2:DescribeRouteTables
              - ec2:CreateRouteTable
              - ec2:AssociateRouteTable
              - ec2:CreateSubnet
              - ec2:ModifySubnetAttribute
            Effect: Allow
            Resource: "*"
            Sid: NetworkingEasyConfig
          - Action:
              - ec2:CreateVolume
              - ec2:RunInstances
              - ec2:AllocateAddress
              - ec2:AssociateAddress
              - ec2:AttachNetworkInterface
              - ec2:AuthorizeSecurityGroupEgress
              - ec2:AuthorizeSecurityGroupIngress
              - ec2:CreateNetworkInterface
              - ec2:CreateSecurityGroup
              - ec2:ModifyVolumeAttribute
              - ec2:ModifyNetworkInterfaceAttribute
              - ec2:DeleteNetworkInterface
              - ec2:DeleteVolume
              - ec2:TerminateInstances
              - ec2:DeleteSecurityGroup
              - ec2:DisassociateAddress
              - ec2:RevokeSecurityGroupIngress
              - ec2:RevokeSecurityGroupEgress
              - ec2:ReleaseAddress
              - ec2:CreatePlacementGroup
              - ec2:DeletePlacementGroup
            Effect: Allow
            Resource: "*"
            Sid: EC2Modify
          - Action:
              - autoscaling:DescribeAutoScalingGroups
              - autoscaling:DescribeAutoScalingInstances
            Effect: Allow
            Resource: "*"
            Sid: AutoScalingDescribe
          - Action:
              - autoscaling:CreateAutoScalingGroup
              - ec2:CreateLaunchTemplate
              - ec2:ModifyLaunchTemplate
              - ec2:DeleteLaunchTemplate
              - ec2:DescribeLaunchTemplates
              - ec2:DescribeLaunchTemplateVersions
              - autoscaling:PutNotificationConfiguration
              - autoscaling:UpdateAutoScalingGroup
              - autoscaling:PutScalingPolicy
              - autoscaling:DescribeScalingActivities
              - autoscaling:DeleteAutoScalingGroup
              - autoscaling:DeletePolicy
              - autoscaling:DisableMetricsCollection
              - autoscaling:EnableMetricsCollection
            Effect: Allow
            Resource: "*"
            Sid: AutoScalingModify
          - Action: dynamodb:DescribeTable
            Effect: Allow
            Resource: "*"
            Sid: DynamoDBDescribe
          - Action:
              - dynamodb:CreateTable
              - dynamodb:DeleteTable
              - dynamodb:TagResource
            Effect: Allow
            Resource: "*"
            Sid: DynamoDBModify
          - Action: sqs:GetQueueAttributes
            Effect: Allow
            Resource: "*"
            Sid: SQSDescribe
          - Action:
              - sqs:CreateQueue
              - sqs:SetQueueAttributes
              - sqs:DeleteQueue
              - sqs:TagQueue
            Effect: Allow
            Resource: "*"
            Sid: SQSModify
          - Action:
              - sns:ListTopics
              - sns:GetTopicAttributes
            Effect: Allow
            Resource: "*"
            Sid: SNSDescribe
          - Action:
              - sns:CreateTopic
              - sns:Subscribe
              - sns:DeleteTopic
            Effect: Allow
            Resource: "*"
            Sid: SNSModify
          - Action:
              - cloudformation:DescribeStackEvents
              - cloudformation:DescribeStackResource
              - cloudformation:DescribeStackResources
              - cloudformation:DescribeStacks
              - cloudformation:ListStacks
              - cloudformation:GetTemplate
            Effect: Allow
            Resource: "*"
            Sid: CloudFormationDescribe
          - Action:
              - cloudformation:CreateStack
              - cloudformation:DeleteStack
              - cloudformation:UpdateStack
            Effect: Allow
            Resource: "*"
            Sid: CloudFormationModify
          - Action:
              - s3:Get*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::ap-east-1-aws-parallelcluster*
              - arn:aws:s3:::ap-northeast-1-aws-parallelcluster*
              - arn:aws:s3:::ap-northeast-2-aws-parallelcluster*
              - arn:aws:s3:::ap-south-1-aws-parallelcluster*
              - arn:aws:s3:::ap-southeast-1-aws-parallelcluster*
              - arn:aws:s3:::ap-southeast-2-aws-parallelcluster*
              - arn:aws:s3:::ca-central-1-aws-parallelcluster*
              - arn:aws:s3:::cn-north-1-aws-parallelcluster*
              - arn:aws:s3:::cn-northwest-1-aws-parallelcluster*
              - arn:aws:s3:::eu-central-1-aws-parallelcluster*
              - arn:aws:s3:::eu-north-1-aws-parallelcluster*
              - arn:aws:s3:::eu-west-1-aws-parallelcluster*
              - arn:aws:s3:::eu-west-2-aws-parallelcluster*
              - arn:aws:s3:::eu-west-3-aws-parallelcluster*
              - arn:aws:s3:::me-south-1-aws-parallelcluster*
              - arn:aws:s3:::sa-east-1-aws-parallelcluster*
              - arn:aws:s3:::us-east-1-aws-parallelcluster*
              - arn:aws:s3:::us-east-2-aws-parallelcluster*
              - arn:aws:s3:::us-gov-east-1-aws-parallelcluster*
              - arn:aws:s3:::us-gov-west-1-aws-parallelcluster*
              - arn:aws:s3:::us-iso-east-1-aws-parallelcluster*
              - arn:aws:s3:::us-isob-east-1-aws-parallelcluster*
              - arn:aws:s3:::us-west-1-aws-parallelcluster*
              - arn:aws:s3:::us-west-2-aws-parallelcluster*
            Sid: S3ParallelClusterReadOnly
          - Action:
              - iam:PassRole
              - iam:CreateRole
              - iam:CreateServiceLinkedRole
              - iam:DeleteRole
              - iam:GetRole
              - iam:TagRole
              - iam:SimulatePrincipalPolicy
            Effect: Allow
            Resource:
              - arn:aws:iam::*:role/*
              - arn:aws:iam::*:role/aws-service-role/*
            Sid: IAMModify
          - Action:
              - iam:CreateInstanceProfile
              - iam:DeleteInstanceProfile
            Effect: Allow
            Resource: arn:aws:iam::*:instance-profile/*
            Sid: IAMCreateInstanceProfile
          - Action:
              - iam:AddRoleToInstanceProfile
              - iam:RemoveRoleFromInstanceProfile
              - iam:GetRolePolicy
              - iam:GetPolicy
              - iam:AttachRolePolicy
              - iam:DetachRolePolicy
              - iam:PutRolePolicy
              - iam:DeleteRolePolicy
            Effect: Allow
            Resource: "*"
            Sid: IAMInstanceProfile
          - Action:
              - elasticfilesystem:DescribeMountTargets
              - elasticfilesystem:DescribeMountTargetSecurityGroups
              - ec2:DescribeNetworkInterfaceAttribute
            Effect: Allow
            Resource: "*"
            Sid: EFSDescribe
          - Action: ssm:GetParametersByPath
            Effect: Allow
            Resource: "*"
            Sid: SSMDescribe
          - Action: fsx:*
            Effect: Allow
            Resource: "*"
            Sid: FSx
          - Action: elasticfilesystem:*
            Effect: Allow
            Resource: "*"
            Sid: EFS
          - Action:
              - logs:DeleteLogGroup
              - logs:PutRetentionPolicy
              - logs:DescribeLogGroups
              - logs:CreateLogGroup
            Effect: Allow
            Resource: "*"
            Sid: CloudWatchLogs
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: pcluster/ParallelClusterUserPolicy
  Cloud9Role4646BA40:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - ec2.
                    - Ref: AWS::URLSuffix
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonSSMManagedInstanceCore
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AWSCloud9User
        - Ref: ParallelClusterUserPolicy
    Metadata:
      aws:cdk:path: pcluster/Cloud9Role/Resource
  Cloud9RoleDefaultPolicy7BF05308:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - ec2:DescribeInstances
              - ec2:DescribeVolumes
              - ec2:ModifyVolume
            Effect: Allow
            Resource: "*"
          - Action: secretsmanager:GetSecretValue
            Effect: Allow
            Resource:
              Ref: SshPrivateKeySecret
          - Action:
              - s3:Get*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - "arn:aws:s3:::"
                    - Ref: DataRepositoryB58C03BE
                    - /*
              - Fn::Join:
                  - ""
                  - - "arn:aws:s3:::"
                    - Ref: DataRepositoryB58C03BE
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":s3:::"
                    - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":s3:::"
                    - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
                    - /*
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":s3:::"
                    - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":s3:::"
                    - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
                    - /*
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":s3:::"
                    - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":s3:::"
                    - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
                    - /*
        Version: "2012-10-17"
      PolicyName: Cloud9RoleDefaultPolicy7BF05308
      Roles:
        - Ref: Cloud9Role4646BA40
    Metadata:
      aws:cdk:path: pcluster/Cloud9Role/DefaultPolicy/Resource
  AdminGroupCD52047A:
    Type: AWS::IAM::Group
    Properties:
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AWSCloud9Administrator
    Metadata:
      aws:cdk:path: pcluster/AdminGroup/Resource
  PowerUserGroupCF23E412:
    Type: AWS::IAM::Group
    Properties:
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/PowerUserAccess
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AWSCloud9Administrator
    Metadata:
      aws:cdk:path: pcluster/PowerUserGroup/Resource
  ResearcherB0ACBDEC:
    Type: AWS::IAM::User
    Properties:
      Groups:
        - Ref: AdminGroupCD52047A
      LoginProfile:
        Password:
          Ref: UserPasswordParameter
        PasswordResetRequired: true
    Metadata:
      aws:cdk:path: pcluster/Researcher/Resource
  Cloud9SetupRole5712B5A6:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Ref: ParallelClusterUserPolicy
    Metadata:
      aws:cdk:path: pcluster/Cloud9SetupRole/Resource
  Cloud9SetupRoleDefaultPolicy60131F34:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - cloudformation:DescribeStackResources
              - ec2:AssociateIamInstanceProfile
              - ec2:AuthorizeSecurityGroupIngress
              - ec2:DescribeInstances
              - ec2:DescribeInstanceStatus
              - ec2:DescribeInstanceAttribute
              - ec2:DescribeIamInstanceProfileAssociations
              - ec2:DescribeVolumes
              - ec2:DesctibeVolumeAttribute
              - ec2:DescribeVolumesModifications
              - ec2:DescribeVolumeStatus
              - ssm:DescribeInstanceInformation
              - ec2:ModifyVolume
              - ec2:ReplaceIamInstanceProfileAssociation
              - ec2:ReportInstanceStatus
              - ssm:SendCommand
              - ssm:GetCommandInvocation
              - s3:GetObject
              - lambda:AddPermission
              - lambda:RemovePermission
              - events:PutRule
              - events:DeleteRule
              - events:PutTargets
              - events:RemoveTargets
              - cloud9:CreateEnvironmentMembership
            Effect: Allow
            Resource: "*"
          - Action: iam:PassRole
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - Cloud9Role4646BA40
                - Arn
          - Action:
              - lambda:AddPermission
              - lambda:RemovePermission
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: Cloud9SetupRoleDefaultPolicy60131F34
      Roles:
        - Ref: Cloud9SetupRole5712B5A6
    Metadata:
      aws:cdk:path: pcluster/Cloud9SetupRole/DefaultPolicy/Resource
  Cloud9InstanceProfile:
    Type: AWS::IAM::InstanceProfile
    Properties:
      Roles:
        - Ref: Cloud9Role4646BA40
    Metadata:
      aws:cdk:path: pcluster/Cloud9InstanceProfile
  C9InstanceProfileLambdaF4D0173E:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersc48822457e8605e268f475d3928a59915c8bb7e090f602882e65a2dcb6f26c8fS3VersionKey4A4E4131
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersc48822457e8605e268f475d3928a59915c8bb7e090f602882e65a2dcb6f26c8fS3VersionKey4A4E4131
      Handler: lambda_function.handler
      Role:
        Fn::GetAtt:
          - Cloud9SetupRole5712B5A6
          - Arn
      Runtime: python3.6
      Timeout: 900
    DependsOn:
      - Cloud9SetupRoleDefaultPolicy60131F34
      - Cloud9SetupRole5712B5A6
    Metadata:
      aws:cdk:path: pcluster/C9InstanceProfileLambda/Resource
      aws:asset:path: asset.c48822457e8605e268f475d3928a59915c8bb7e090f602882e65a2dcb6f26c8f
      aws:asset:property: Code
  C9InstanceProfileProviderframeworkonEventServiceRole77941550:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: pcluster/C9InstanceProfileProvider/framework-onEvent/ServiceRole/Resource
  C9InstanceProfileProviderframeworkonEventServiceRoleDefaultPolicy2FAE1433:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - C9InstanceProfileLambdaF4D0173E
                - Arn
        Version: "2012-10-17"
      PolicyName: C9InstanceProfileProviderframeworkonEventServiceRoleDefaultPolicy2FAE1433
      Roles:
        - Ref: C9InstanceProfileProviderframeworkonEventServiceRole77941550
    Metadata:
      aws:cdk:path: pcluster/C9InstanceProfileProvider/framework-onEvent/ServiceRole/DefaultPolicy/Resource
  C9InstanceProfileProviderframeworkonEvent2F224CFE:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14S3VersionKeyCDA54A41
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14S3VersionKeyCDA54A41
      Handler: framework.onEvent
      Role:
        Fn::GetAtt:
          - C9InstanceProfileProviderframeworkonEventServiceRole77941550
          - Arn
      Runtime: nodejs10.x
      Description: AWS CDK resource provider framework - onEvent (pcluster/C9InstanceProfileProvider)
      Environment:
        Variables:
          USER_ON_EVENT_FUNCTION_ARN:
            Fn::GetAtt:
              - C9InstanceProfileLambdaF4D0173E
              - Arn
      Timeout: 900
    DependsOn:
      - C9InstanceProfileProviderframeworkonEventServiceRoleDefaultPolicy2FAE1433
      - C9InstanceProfileProviderframeworkonEventServiceRole77941550
    Metadata:
      aws:cdk:path: pcluster/C9InstanceProfileProvider/framework-onEvent/Resource
      aws:asset:path: asset.812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14
      aws:asset:property: Code
  C9InstanceProfile:
    Type: AWS::CloudFormation::CustomResource
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - C9InstanceProfileProviderframeworkonEvent2F224CFE
          - Arn
      InstanceProfile:
        Ref: Cloud9InstanceProfile
      Cloud9Environment:
        Ref: ResearchWorkspace61444B30
    DependsOn:
      - ResearchWorkspace61444B30
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: pcluster/C9InstanceProfile/Default
  C9BootstrapLambda366B3653:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters68144a2b2756f242701a24eb133be85c64921da0317f4d548d4ae8c39a2c30bfS3VersionKey28D10DE9
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters68144a2b2756f242701a24eb133be85c64921da0317f4d548d4ae8c39a2c30bfS3VersionKey28D10DE9
      Handler: lambda_function.handler
      Role:
        Fn::GetAtt:
          - Cloud9SetupRole5712B5A6
          - Arn
      Runtime: python3.6
      Timeout: 900
    DependsOn:
      - Cloud9SetupRoleDefaultPolicy60131F34
      - Cloud9SetupRole5712B5A6
    Metadata:
      aws:cdk:path: pcluster/C9BootstrapLambda/Resource
      aws:asset:path: asset.68144a2b2756f242701a24eb133be85c64921da0317f4d548d4ae8c39a2c30bf
      aws:asset:property: Code
  C9BootstrapProviderframeworkonEventServiceRole9DB6888B:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: pcluster/C9BootstrapProvider/framework-onEvent/ServiceRole/Resource
  C9BootstrapProviderframeworkonEventServiceRoleDefaultPolicy4618A7E0:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - C9BootstrapLambda366B3653
                - Arn
        Version: "2012-10-17"
      PolicyName: C9BootstrapProviderframeworkonEventServiceRoleDefaultPolicy4618A7E0
      Roles:
        - Ref: C9BootstrapProviderframeworkonEventServiceRole9DB6888B
    Metadata:
      aws:cdk:path: pcluster/C9BootstrapProvider/framework-onEvent/ServiceRole/DefaultPolicy/Resource
  C9BootstrapProviderframeworkonEvent2A7A53DB:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14S3VersionKeyCDA54A41
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14S3VersionKeyCDA54A41
      Handler: framework.onEvent
      Role:
        Fn::GetAtt:
          - C9BootstrapProviderframeworkonEventServiceRole9DB6888B
          - Arn
      Runtime: nodejs10.x
      Description: AWS CDK resource provider framework - onEvent (pcluster/C9BootstrapProvider)
      Environment:
        Variables:
          USER_ON_EVENT_FUNCTION_ARN:
            Fn::GetAtt:
              - C9BootstrapLambda366B3653
              - Arn
      Timeout: 900
    DependsOn:
      - C9BootstrapProviderframeworkonEventServiceRoleDefaultPolicy4618A7E0
      - C9BootstrapProviderframeworkonEventServiceRole9DB6888B
    Metadata:
      aws:cdk:path: pcluster/C9BootstrapProvider/framework-onEvent/Resource
      aws:asset:path: asset.812fb1ad6d57643790c0c720ff7b1226e49679db821db771446a9a950a477b14
      aws:asset:property: Code
  C9Bootstrap:
    Type: AWS::CloudFormation::CustomResource
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - C9BootstrapProviderframeworkonEvent2A7A53DB
          - Arn
      Cloud9Environment:
        Ref: ResearchWorkspace61444B30
      BootstrapPath:
        Fn::Join:
          - ""
          - - s3://
            - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
            - /
            - Fn::Select:
                - 0
                - Fn::Split:
                    - "||"
                    - Ref: AssetParameters9c761b804ba7cab28d2fd36fee5aa148843ae638efacbfe6873873076ddc24cfS3VersionKeyFDCEC68A
            - Fn::Select:
                - 1
                - Fn::Split:
                    - "||"
                    - Ref: AssetParameters9c761b804ba7cab28d2fd36fee5aa148843ae638efacbfe6873873076ddc24cfS3VersionKeyFDCEC68A
      Config:
        Fn::Join:
          - ""
          - - https://
            - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
            - .s3.amazonaws.com/
            - Fn::Select:
                - 0
                - Fn::Split:
                    - "||"
                    - Ref: AssetParametersdb9afb32f11d5a6d27d926a7a69534f2f60c256e04782b6d75c5177cf6c51cf6S3VersionKeyD868A528
            - Fn::Select:
                - 1
                - Fn::Split:
                    - "||"
                    - Ref: AssetParametersdb9afb32f11d5a6d27d926a7a69534f2f60c256e04782b6d75c5177cf6c51cf6S3VersionKeyD868A528
      VPCID:
        Ref: VPCB9E5F0B4
      MasterSubnetID:
        Ref: VPCPublicSubnet1SubnetB4246D30
      ComputeSubnetID:
        Ref: VPCPrivateSubnet1Subnet8BCA10E0
      PostInstallScriptS3Url:
        Fn::Join:
          - ""
          - - s3://
            - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
            - /
            - Fn::Select:
                - 0
                - Fn::Split:
                    - "||"
                    - Ref: AssetParameters1f8b4760af092cc9f4253348dd8d0713337cb9dc8163e76a45d3815dffd38187S3VersionKey3E1A0BD1
            - Fn::Select:
                - 1
                - Fn::Split:
                    - "||"
                    - Ref: AssetParameters1f8b4760af092cc9f4253348dd8d0713337cb9dc8163e76a45d3815dffd38187S3VersionKey3E1A0BD1
      PostInstallScriptBucket:
        !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
      S3ReadWriteResource:
        Fn::GetAtt:
          - DataRepositoryB58C03BE
          - Arn
      S3ReadWriteUrl:
        Fn::Join:
          - ""
          - - s3://
            - Ref: DataRepositoryB58C03BE
      KeyPairId:
        Ref: C9CreateKeyPair
      KeyPairSecretArn:
        Ref: SshPrivateKeySecret
      UserArn:
        Fn::GetAtt:
          - ResearcherB0ACBDEC
          - Arn
    DependsOn:
      - C9CreateKeyPair
      - C9InstanceProfile
      - DataRepositoryB58C03BE
      - SshPrivateKeySecret
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: pcluster/C9Bootstrap/Default
  HPCBudget:
    Type: AWS::Budgets::Budget
    Properties:
      Budget:
        BudgetLimit:
          Amount:
            Ref: BudgetLimit
          Unit: USD
        BudgetType: COST
        CostTypes:
          IncludeCredit: false
          IncludeDiscount: true
          IncludeOtherSubscription: true
          IncludeRecurring: true
          IncludeRefund: true
          IncludeSubscription: true
          IncludeSupport: true
          IncludeTax: true
          IncludeUpfront: true
          UseAmortized: false
          UseBlended: false
        TimeUnit: ANNUALLY
      NotificationsWithSubscribers:
        - Notification:
            ComparisonOperator: GREATER_THAN
            NotificationType: ACTUAL
            Threshold: 80
            ThresholdType: PERCENTAGE
          Subscribers:
            - Address:
                Ref: NotificationEmail
              SubscriptionType: EMAIL
    Metadata:
      aws:cdk:path: pcluster/HPCBudget
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.52.0,@aws-cdk/assets=1.53.0,@aws-cdk/aws-budgets=1.53.0,@aws-cdk/aws-cloud9=1.53.0,@aws-cdk/aws-cloudformation=1.53.0,@aws-cdk/aws-cloudtrail=1.53.0,@aws-cdk/aws-cloudwatch=1.53.0,@aws-cdk/aws-codecommit=1.53.0,@aws-cdk/aws-codeguruprofiler=1.53.0,@aws-cdk/aws-ec2=1.53.0,@aws-cdk/aws-efs=1.53.0,@aws-cdk/aws-events=1.53.0,@aws-cdk/aws-iam=1.53.0,@aws-cdk/aws-kms=1.53.0,@aws-cdk/aws-lambda=1.53.0,@aws-cdk/aws-logs=1.53.0,@aws-cdk/aws-s3=1.53.0,@aws-cdk/aws-s3-assets=1.53.0,@aws-cdk/aws-sam=1.53.0,@aws-cdk/aws-secretsmanager=1.53.0,@aws-cdk/aws-sns=1.53.0,@aws-cdk/aws-sqs=1.53.0,@aws-cdk/aws-ssm=1.53.0,@aws-cdk/cloud-assembly-schema=1.53.0,@aws-cdk/core=1.53.0,@aws-cdk/custom-resources=1.53.0,@aws-cdk/cx-api=1.53.0,@aws-cdk/region-info=1.53.0,jsii-runtime=Python/3.8.2
    Condition: CDKMetadataAvailable
Outputs:
  PublicSubnet0:
    Value:
      Ref: VPCPublicSubnet1SubnetB4246D30
  PublicSubnet1:
    Value:
      Ref: VPCPublicSubnet2Subnet74179F39
  PrivateSubnet0:
    Value:
      Ref: VPCPrivateSubnet1Subnet8BCA10E0
  PrivateSubnet1:
    Value:
      Ref: VPCPrivateSubnet2SubnetCFCDAA7A
  VPCId:
    Value:
      Ref: VPCB9E5F0B4
  DataRespository:
    Value:
      Ref: DataRepositoryB58C03BE
  ResearchWorkspaceURL:
    Value:
      Fn::Join:
        - ""
        - - https://
          - Ref: AWS::Region
          - .console.aws.amazon.com/cloud9/ide/
          - Ref: ResearchWorkspace61444B30
  UserLoginUrl:
    Value:
      Fn::Join:
        - ""
        - - https://
          - Ref: AWS::AccountId
          - .signin.aws.amazon.com/console
  UserName:
    Value:
      Ref: ResearcherB0ACBDEC
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

